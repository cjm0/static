<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>静态测试</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="stylesheet" type="text/css" href="./test/reset.css">
	<style type="text/css">
    	html{
    		font-size: 14px;
    	}

			line-height: 1;

		}
        .a img{
            width: 300px;
        }
	</style>
</head>
<body>
<div class="a" id="a">
        <p>过一个平凡无趣的人生实在太容易了，你可以不读书，不冒险，不运动，不写作，不外出，不折腾……但是，人生最后悔的事情就是：我本可以。</p>
       <p>ppppppppppppp</p>
   
       <img src="https://img.zcool.cn/community/011a5859ac137ea8012028a92fc78a.jpg@1280w_1l_2o_100sh.jpg">
</div>

<input type="file" name="" value="选择图片" accept="image/png,image/jpg"/>

<input type="file" accept="image/png,image/jpg" capture="camera">


<a class="down" href="" download="down">下载</a>

<script src="https://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>

<script src="./test/html2canvas.min.js"></script>
<!-- <script src="./dom-to-image.min.js"></script> -->

<script>
$(function(){

    var node = document.getElementById('a');

    /*
        https://github.com/tsayen/dom-to-image
        https://www.colabug.com/2256528.html
    */
    /*
        function filter (node) {
            return (node.tagName !== 'i');
        }
        var node = document.getElementById('a');

        domtoimage.toSvg(node, {filter: filter})
        .then(function (dataUrl) {
            var img = new Image();
            img.src = dataUrl;
            document.body.appendChild(img);
        });
    */





    /*
        http://html2canvas.hertzen.com/configuration
    */
    
    /*
    let imgWidth = node.offsetWidth // 获取DOM宽度
    let imgHeight = node.offsetHeight // 获取DOM高度
    let scale = 2 // 定义放大倍数

    let canvas = document.createElement("canvas") 
    canvas.width = imgWidth * scale; // 定义canvas 宽度 * 缩放
    canvas.height = imgHeight * scale; // 定义canvas高度 *缩放
    canvas.style.width = imgWidth + "px";
    canvas.style.height = imgHeight + "px";

    html2canvas(node, {
        scale: scale,
        width: imgWidth,
        height: imgHeight,
        logging:false,
        useCORS:true,
    }).then(canvas => {
        var dataUrl = canvas.toDataURL("image/jpge", 0.7);
        var img = new Image();
        img.src = dataUrl;
        document.body.appendChild(img);

        document.querySelector(".down").setAttribute('href', dataUrl);
    });
    */

    let w = node.offsetWidth // 获取DOM宽度
    let h = node.offsetHeight // 获取DOM高度
    var scale // 定义放大倍数
    if (window.devicePixelRatio) {
        scale = window.devicePixelRatio
    } else {
        scale = 2
    }

    html2canvas(node, {
        scale: scale,
        width: w,
        height: h,
        logging:false,
        useCORS:true,
    }).then(canvas => {
        var dataUrl = canvas.toDataURL("image/jpge", 0.7);
        var img = new Image();
        img.src = dataUrl;
        document.body.appendChild(img);

        document.querySelector(".down").setAttribute('href', dataUrl);
    });
})
</script>
</body>
</html>